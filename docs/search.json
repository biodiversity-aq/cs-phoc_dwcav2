[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Mapping population census dataset to DwCA v2",
    "section": "",
    "text": "Attempt to map CS-PHOC dataset as a Survey use case of the new data model to DwCAv2.\nData paper that describes the population census of phocids: https://doi.org/10.1038/s41597-024-03744-9\nDataset is available as Darwin Core Archive at https://ipt-obis.gbif.us/resource?r=usamlr_cs-phoc"
  },
  {
    "objectID": "index.html#load-libraries",
    "href": "index.html#load-libraries",
    "title": "Mapping population census dataset to DwCA v2",
    "section": "Load libraries",
    "text": "Load libraries\n\nlibrary(here)\nlibrary(tidyverse)"
  },
  {
    "objectID": "index.html#read-files",
    "href": "index.html#read-files",
    "title": "Mapping population census dataset to DwCA v2",
    "section": "Read files",
    "text": "Read files\n\nevent &lt;- read_delim(\"https://raw.githubusercontent.com/us-amlr/cs-phoc/refs/heads/main/data/dwca/event.txt\", delim = \"\\t\", show_col_types = FALSE)\nocc &lt;- read_delim(\"https://raw.githubusercontent.com/us-amlr/cs-phoc/refs/heads/main/data/dwca/occurrence.txt\", delim = \"\\t\", show_col_types = FALSE)"
  },
  {
    "objectID": "index.html#dwca-v2",
    "href": "index.html#dwca-v2",
    "title": "Mapping population census dataset to DwCA v2",
    "section": "DwCA v2",
    "text": "DwCA v2\nThe mapping is based on schema from https://rs.gbif.org/sandbox/experimental/data-packages/dwca_v2/0.1/\n\nEvent table\n\nevent &lt;- event %&gt;%\n  mutate(\n    eventClass = \"Survey\",\n    eventType = \"Survey\", \n    eventProtocolID = \"CS-PHOC-Census\" \n  )\n\n\n\nSurvey table\n\nsurvey &lt;- event %&gt;%\n  select(eventID, sampleSizeValue, sampleSizeUnit, dynamicProperties) %&gt;%\n  rename(\n    surveyID = eventID,\n    eventDurationValue = sampleSizeValue,\n    eventDurationUnit = sampleSizeUnit\n  ) %&gt;%\n  mutate(\n    targetTaxonomicScope = \"Lobodon carcinophaga | Mirounga leonina | Leptonychotes weddellii | Hydrurga leptonyx\",\n    taxonCompletenessReported = \"\", # TODO\n    taxonCompletenessProtocols = \"census\",\n    isTaxonomicScopeFullyReported = \"true\", \n    isAbsenceReported = \"true\", # does not need absentTaxa\n    hasNonTargetTaxa = \"false\",\n    isAbundanceReported = \"true\",\n    isLeastSpecificTargetCategoryQuantityInclusive = \"false\", \n    hasMaterialSamples = \"false\",\n    isSamplingEffortReported = \"false\",\n    samplingPerformedBy = case_when(\n      str_detect(dynamicProperties, \"INACH\") ~ \"INACH\",\n      str_detect(dynamicProperties, \"USAMLR\") ~ \"USAMLR\",\n      TRUE ~ NA_character_  # Default for unmatched cases\n    )\n  ) \n\n\n\nSurvey-target table\nFrom paper:\n\nBiologists used field notebooks to record counts of each phocid species at each location, along with age class and sex when possible.\n\nShould sex and lifeStage be part of survey target? It is not always possible to record these values. Is unknown a valid value?\n\nsurvey_target_taxa &lt;- occ %&gt;%\n  distinct(scientificName) %&gt;%\n  rename(surveyTargetValue = scientificName) %&gt;%\n  mutate(\n    surveyTargetType = \"taxon\",\n    includeOrExclude = \"include\",\n    surveyTargetID = case_when(\n      surveyTargetValue == \"Lobodon carcinophaga\" ~ \"344008\",\n      surveyTargetValue == \"Mirounga leonina\" ~ \"231413\",\n      surveyTargetValue == \"Hydrurga leptonyx\" ~ \"231417\",\n      surveyTargetValue == \"Leptonychotes weddellii\" ~ \"195932\",\n      TRUE ~ NA_character_  # Handles cases where no match is found\n      ) \n    )\n\n# repeat all survey_target_taxa for each surveyID\nsurvey_target &lt;- survey %&gt;% \n  select(surveyID) %&gt;%\n  crossing(survey_target_taxa) # repeat target taxa for all surveyID\n\n\n\nSurvey-target-abundance table\nsex and lifeStage need to be specified with Assertions when it is not specified as part of target. However, there is no surveyTargetAbundanceID in this table, so how can I point Assertion record to surveyTargetAbundance record?\n\nsurvey_target_abd &lt;- occ %&gt;%\n  select(scientificName, scientificNameID, individualCount, sex, lifeStage) %&gt;%\n  rename(\n    observedTaxon = scientificName,\n    observedTaxonID = scientificNameID,\n    organismQuantity = individualCount\n    ) %&gt;%\n  mutate(\n    organismQuantityType = case_when(\n      organismQuantity &lt;= 1 ~ \"individual\",\n      organismQuantity &gt; 1 ~ \"individuals\"\n    ),\n    surveyTargetID = case_when(\n      observedTaxon == \"Lobodon carcinophaga\" ~ \"344008\",\n      observedTaxon == \"Mirounga leonina\" ~ \"231413\",\n      observedTaxon == \"Hydrurga leptonyx\" ~ \"231417\",\n      observedTaxon == \"Leptonychotes weddellii\" ~ \"195932\",\n      TRUE ~ NA_character_  # Handles cases where no match is found\n      )\n  )\n\n\n\nProtocol table\nProtocols are linked in a weird way:\n- Event.eventProtocolID = CS-PHOC-Census = Protocol.protocolID\n- Protocol.protocolTargetID = Survey.surveyID = Event.eventID\nData protocol is only linked to Survey.surveyID. Does it make sense to have data protocol structured in this way?\n\ncensus_protocol &lt;- survey %&gt;%\n  select(surveyID) %&gt;%\n  rename(protocolTargetID = surveyID) %&gt;%\n  mutate(\n    protocolID = \"CS-PHOC-Census\",\n    protocolTargetType = \"Survey\",\n    protocolType = \"Census\",\n    protocolName = \"census protocol\",\n    protocolDescription = \"Trained field biologists surveyed safely accessible regions of Cape Shirreff and recorded all live phocids. Biologists used field notebooks to record counts of each phocid species at each location, along with age class and sex when possible. Phocids were only recorded if they were hauled out on land, and not if they were for instance on an ice flow or swimming just offshore. After the survey, data were entered into a database or otherwise archived. Locations were surveyed on foot, by either walking through haul-out locations or using binoculars from a high vantage point where practical. While the full extent of the area surveyed varied slightly both across and within seasons, core census locations were always surveyed. These core census locations span the vast majority of phocid haul-out locations at Cape Shirreff, thereby ensuring that CS-PHOC data are both consistent and representative of phocid haul-out at Cape Shirreff across all censuses and seasons.\",\n    protocolCitation = \"Woodman, S.M., Borras-Chavez, R., Goebel, M.E. et al. CS-PHOC: weekly census counts of Southern Ocean phocids at Cape Shirreff, Livingston Island. Sci Data 11, 895 (2024). https://doi.org/10.1038/s41597-024-03744-9\"\n  )\n\ndata_protocol &lt;- survey %&gt;%\n  select(surveyID) %&gt;%\n  rename(protocolTargetID = surveyID) %&gt;%\n  mutate(\n    protocolID = \"CS-PHOC-Data\",\n    protocolTargetType = \"Survey\",\n    protocolType = \"Data cleaning and aggregation\",\n    protocolName = \"Data cleaning and aggregation\",\n    protocolDescription = \"Data records were compiled from historical documents, field notebooks, Excel files, and a SQL Server database. INACH historical data (i.e., paper records, reports, and Excel files) were consolidated into Excel files. These INACH files, along with historical U.S. AMLR Excel files, were imported into the U.S. AMLR Pinniped SQL Server database using R (v4.3). Once in the database, all data were read into R, where they were cleaned and standardized as follows. Location names and count types (i.e., age class and sex) were converted to standard names, and columns containing count data were aggregated to the lowest resolution across datasets. For instance, some seasons male and female pup counts were recorded separately, but during others only a single count of all pups was recorded. Thus, for this dataset, all pup counts were aggregated to a single, total pup count for each survey record. In addition, recorded data varied slightly across programs. Specifically, data from INACH surveys included explicit zero records when there were none of a particular phocid species at a location, while data from U.S. AMLR surveys only included non-zero counts. To make these data consistent, U.S. AMLR data were made explicit by adding zero records as necessary. After data cleaning and standardization, records from the core census locations were grouped and aggregated to provide a single, comparable count for each species for each census. Specifically, records were filtered for core census locations, and counts were summed after grouping by census and species. These aggregated core census location counts, along with counts for one other location (Punta San Telmo, described in “Data Records” in the publication), make up the published CS-PHOC dataset.\",\n    protocolCitation = \"Woodman, S.M., Borras-Chavez, R., Goebel, M.E. et al. CS-PHOC: weekly census counts of Southern Ocean phocids at Cape Shirreff, Livingston Island. Sci Data 11, 895 (2024). https://doi.org/10.1038/s41597-024-03744-9\"\n  )\n\nprotocol &lt;- rbind(census_protocol, data_protocol)"
  },
  {
    "objectID": "index.html#write-files",
    "href": "index.html#write-files",
    "title": "Mapping population census dataset to DwCA v2",
    "section": "Write files",
    "text": "Write files\n\nwrite_tsv(event, here(\"output\", \"event.txt\"), na = \"\", quote = \"none\")\nwrite_tsv(survey, here(\"output\", \"survey.txt\"), na = \"\", quote = \"none\")\nwrite_tsv(survey_target, here(\"output\", \"survey_target.txt\"), na = \"\", quote = \"none\")\nwrite_tsv(survey_target_abd, here(\"output\", \"survey_target_abundance.txt\"), na = \"\", quote = \"none\")\nwrite_tsv(protocol, here(\"output\", \"protocol.txt\"), na = \"\", quote = \"none\")"
  },
  {
    "objectID": "index.html#citation",
    "href": "index.html#citation",
    "title": "Mapping population census dataset to DwCA v2",
    "section": "Citation",
    "text": "Citation\nWoodman, S.M., Borras-Chavez, R., Goebel, M.E. et al. CS-PHOC: weekly census counts of Southern Ocean phocids at Cape Shirreff, Livingston Island. Sci Data 11, 895 (2024). https://doi.org/10.1038/s41597-024-03744-9"
  }
]